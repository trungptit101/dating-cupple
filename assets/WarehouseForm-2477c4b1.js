import{d as se,r as i,l as oe,m as re,a as C,e as F,f as o,g as t,i as c,w as T,b as _,T as M,c as ne,A as ie,F as ue,y as j,u as de,Y as ce,E as Q,q as me,a1 as pe,_ as he}from"./index-6d8ceaa0.js";/* empty css                     */import"./el-col-358a2cfc.js";import{C as ge}from"./CPageContainer-bffd0214.js";import{S as I}from"./http-7590b1ae.js";import{d as $,r as m}from"./validate-14f65514.js";import{C as z}from"./CCardContainer-be34a2a2.js";import{E as fe}from"./EImg-afc854a5.js";import{E as ve,a as _e}from"./EUploadArea-7dc7af5c.js";import{u as Ie,E as x,a as ye}from"./useLocation-ed3cc452.js";import{B as H,_ as Y}from"./BaseService-9e915818.js";import{W as k}from"./WarehouseService-af7763d2.js";import{E as we}from"./index-1e444a29.js";import{E as be,a as Ve}from"./index-41581288.js";import{E as Ce,a as Te}from"./index-35bd09da.js";import"./index-1594f5df.js";import"./event-9519ab40.js";import"./validator-7169f7a8.js";const xe={class:"d-flex align-items-center justify-between mb-16"},ke={class:"d-flex align-items-center justify-between mb-16"},Le={class:"form__images d-flex align-items-center justify-start flex-wrap"},Ee={class:"form__actions d-flex justify-end align-items-center mt-16"},Se=se({__name:"WarehouseForm",setup(qe){const L=de(),p=ce(),u=Ie(),E=i(),l=i({images:[],name:"",code:"",warehouseTypeId:null,warehouseType:"",persionInChargeId:null,persionIncharge:"",status:null,createdAt:"",updatedAt:"",provinceId:null,districtId:null,wardId:null,address:"",description:""}),G=i({name:[$({required:!0,message:"Tên kho hàng là bắt buộc",trigger:"change"})],warehouseTypeId:[m({required:!0,message:"Loại kho là bắt buộc",trigger:"change"})],provinceId:[m({required:!0,message:"Tỉnh thành là bắt buộc",trigger:"change"})],districtId:[m({required:!0,message:"Quận huyện là bắt buộc",trigger:"change"})],wardId:[m({required:!0,message:"Phường xã là bắt buộc",trigger:"change"})],address:[$({required:!0,message:"Địa chỉ là bắt buộc",trigger:"change"})],persionInChargeId:[m({required:!0,message:"Người phụ trách là bắt buộc",trigger:"change"})]}),y=i(!1),h=i(!1),g=i(!1),f=oe({unitList:[],warehouseTypeList:[],staffList:[],weightUnitList:[]}),S=i({page:1,pageSize:10,key:"",status:null}),q=i({page:1,pageSize:10,key:"",status:null}),d=i(p.params.id?p.params.id.toString():null),U=i(p.path.split("/")[p.path.split("/").length-2]);re(async()=>{await Promise.all([u.getListProvinces()]),d.value?await O(d.value):await Promise.all([b(),w()])});const J=e=>{u.changeProvinceId(e),l.value.districtId=null,l.value.wardId=null},K=e=>{u.changeDistrictId(e),l.value.wardId=null},O=async e=>{const{code:a,data:r}=await k.getDetail(e);a===I&&X(r)},X=async e=>{await Promise.all([b(e.warehouseType),w(e.persionIncharge)]),l.value={images:e.images||[],name:e.name||"",code:e.code||"",warehouseTypeId:e.warehouseTypeId||null,warehouseType:e.warehouseType||"",persionInChargeId:e.persionInChargeId||null,persionIncharge:e.persionIncharge||"",status:e.status||null,createdAt:e.createdAt||"",updatedAt:e.updatedAt||"",provinceId:e.provinceId||null,districtId:e.districtId||null,wardId:e.wardId||null,address:e.address||"",description:e.description||""},e.provinceId&&u.getListDistricts(e.provinceId),e.districtId&&u.getListWards(e.districtId)},N=e=>{var a;(a=l.value.images)==null||a.push(e.url)},Z=e=>{var a;(a=l.value.images)==null||a.splice(e,1)},w=async e=>{try{h.value=!0,q.value.key=e?e.trim():"";const{code:a,data:r}=await H.getListStaff(q.value);a===I&&(f.staffList=r.items,h.value=!1)}catch{h.value=!1}},b=async e=>{try{g.value=!0,S.value.key=e?e.trim():"";const{code:a,data:r}=await H.getListWarehouseType(S.value);a===I&&(f.warehouseTypeList=r.items,g.value=!1)}catch{g.value=!1}},ee=async e=>{e&&await e.validate(async a=>{if(a)try{console.log(111,l.value);const r={...l.value,name:l.value.name?l.value.name.trim():"",code:l.value.code?l.value.code.toUpperCase().trim().replace(/\s/g,""):"",address:l.value.address?l.value.address.trim():""};console.log(222,r),y.value=!0;let n="";d.value&&(n="Cập nhật thành công"),d.value||(n="Thêm mới thành công"),d.value&&U.value==="coppy"&&(n="Nhân bản thành công");const{code:v,message:V}=d.value&&U.value!=="coppy"?await k.update(Number(d.value),r):await k.create(r);if(v===I)return Q({message:n,type:"success"}),L.pushByPath("/warehouse");Q({message:V,type:"error"})}catch(r){console.log(r)}finally{y.value=!1}})};return(e,a)=>{const r=we,n=be,v=Ce,V=Te,ae=Ve,P=me,le=pe("uppercase-trim");return C(),F(c(ge),{class:"form",title:""},{default:o(()=>[t(ae,{ref_key:"formRef",ref:E,model:l.value,rules:G.value,"label-position":"top"},{default:o(()=>[t(V,{gutter:30},{default:o(()=>[t(v,{xs:24,md:16},{default:o(()=>[t(c(z),{title:"Thông tin chung",class:"mb-16 h-full"},{default:o(()=>[t(n,{label:"Tên kho hàng",required:"",class:"mb-16",prop:"name"},{default:o(()=>[t(r,{modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=s=>l.value.name=s),placeholder:"Nhập tên kho hàng"},null,8,["modelValue"])]),_:1}),t(n,{label:"Mã kho",class:"mb-16",prop:"code"},{default:o(()=>[T(t(r,{modelValue:l.value.code,"onUpdate:modelValue":a[1]||(a[1]=s=>l.value.code=s),placeholder:"Nhập mã kho hàng",maxlength:256},null,8,["modelValue"]),[[le]])]),_:1}),t(n,{required:"",label:"Loại kho",class:"mb-16",prop:"warehouseTypeId"},{default:o(()=>[t(Y,{items:f.warehouseTypeList,remote:!0,filterable:!0,"reserve-keyword":!0,"remote-show-suffix":!0,loading:g.value,remoteMethod:b,"item-value":"value","item-label":"label",modelValue:l.value.warehouseTypeId,"onUpdate:modelValue":a[2]||(a[2]=s=>l.value.warehouseTypeId=s),class:"w-full",placeholder:"Vui lòng chọn"},null,8,["items","loading","modelValue"])]),_:1}),_("div",xe,[t(n,{label:"Tỉnh thành",required:"",class:"pr-8 flex-50",prop:"provinceId"},{default:o(()=>[t(x,{placeholder:"Vui lòng chọn",items:c(u).listProvinces.value,modelValue:l.value.provinceId,"onUpdate:modelValue":a[3]||(a[3]=s=>l.value.provinceId=s),onChange:J},null,8,["items","modelValue"])]),_:1}),t(n,{label:"Quận huyện",required:"",class:"flex-50",prop:"districtId"},{default:o(()=>[t(x,{placeholder:"Vui lòng chọn",items:c(u).listDistricts.value,modelValue:l.value.districtId,"onUpdate:modelValue":a[4]||(a[4]=s=>l.value.districtId=s),onChange:K},null,8,["items","modelValue"])]),_:1})]),_("div",ke,[t(n,{label:"Phường xã",required:"",class:"pr-8 flex-50",prop:"wardId"},{default:o(()=>[t(x,{placeholder:"Vui lòng chọn",items:c(u).listWards.value,modelValue:l.value.wardId,"onUpdate:modelValue":a[5]||(a[5]=s=>l.value.wardId=s)},null,8,["items","modelValue"])]),_:1}),t(n,{label:"Địa chỉ",required:"",class:"flex-50",prop:"address"},{default:o(()=>[t(r,{modelValue:l.value.address,"onUpdate:modelValue":a[6]||(a[6]=s=>l.value.address=s),placeholder:"Nhập địa chỉ"},null,8,["modelValue"])]),_:1})]),t(n,{required:"",label:"Người phụ trách",class:"mb-16",prop:"persionInChargeId"},{default:o(()=>[t(Y,{items:f.staffList,remote:!0,filterable:!0,"reserve-keyword":!0,"remote-show-suffix":!0,loading:h.value,remoteMethod:w,"item-value":"value","item-label":"label",modelValue:l.value.persionInChargeId,"onUpdate:modelValue":a[7]||(a[7]=s=>l.value.persionInChargeId=s),class:"w-full",placeholder:"Vui lòng chọn"},null,8,["items","loading","modelValue"])]),_:1}),t(n,{label:"Mô tả kho hàng",class:"form__item"},{default:o(()=>[t(ye,{modelValue:l.value.description,"onUpdate:modelValue":a[8]||(a[8]=s=>l.value.description=s),placeholder:"Nhập mô tả"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(v,{xs:24,md:8},{default:o(()=>[t(c(z),{title:"Ảnh kho hàng",class:"mb-16 h-full"},{default:o(()=>{var s,B,W,D,R;return[T(_("div",Le,[(C(!0),ne(ue,null,ie((s=l.value)==null?void 0:s.images,(te,A)=>(C(),F(fe,{src:te,key:A,index:A,size:"80px","show-remove":"",class:"mr-16 mb-8",radius:"6px",onRemove:Z},null,8,["src","index"]))),128)),t(ve,{multiple:!0,onChange:N,title:"Tải lên"})],512),[[M,(W=(B=l.value)==null?void 0:B.images)==null?void 0:W.length]]),T(t(_e,{onChange:N},null,512),[[M,!((R=(D=l.value)==null?void 0:D.images)!=null&&R.length)]])]}),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"]),_("div",Ee,[t(P,{class:"form__actions__btn form__actions__btn--cancel",onClick:a[9]||(a[9]=s=>c(L).pushByPath("/warehouse"))},{default:o(()=>[j("Hủy bỏ ")]),_:1}),t(P,{class:"form__actions__btn",type:"primary",onClick:a[10]||(a[10]=s=>ee(E.value)),loading:y.value},{default:o(()=>[j("Lưu lại ")]),_:1},8,["loading"])])]),_:1})}}});const Ke=he(Se,[["__scopeId","data-v-6f7eab03"]]);export{Ke as default};
